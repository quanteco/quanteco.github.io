<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en-US" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang="en-US" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang="en-US" prefix="og: http://ogp.me/ns#"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en-US" prefix="og: http://ogp.me/ns#"> <!--<![endif]-->
<head>
<base href="http://localhost:4000" />

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Developing Distance Based Neighborhood Matrices -</title>

<!-- This site is optimized with the Yoast SEO plugin v3.0.7 - https://yoast.com/wordpress/plugins/seo/ -->
<link rel="canonical" href="http://localhost:4000/blog-on-quantitative-ecology/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:4000/blog-on-quantitative-ecology/" />
<!-- / Yoast SEO plugin. -->



		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/gregorybanderson.elementfx.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.4.2"}};
			!function(a,b,c){function d(a){var c,d=b.createElement("canvas"),e=d.getContext&&d.getContext("2d"),f=String.fromCharCode;return e&&e.fillText?(e.textBaseline="top",e.font="600 32px Arial","flag"===a?(e.fillText(f(55356,56806,55356,56826),0,0),d.toDataURL().length>3e3):"diversity"===a?(e.fillText(f(55356,57221),0,0),c=e.getImageData(16,16,1,1).data.toString(),e.fillText(f(55356,57221,55356,57343),0,0),c!==e.getImageData(16,16,1,1).data.toString()):("simple"===a?e.fillText(f(55357,56835),0,0):e.fillText(f(55356,57135),0,0),0!==e.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag"),unicode8:d("unicode8"),diversity:d("diversity")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag&&c.supports.unicode8&&c.supports.diversity||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='rb-font-awesome-css'  href='//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css?ver=4.4.0' type='text/css' media='all' />
<link rel='stylesheet' id='rb-styles-css'  href='http://localhost:4000/wp-content/plugins/resume-builder/css/resume-builder-styles.css?ver=4.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='easy_table_style-css'  href='http://localhost:4000/wp-content/plugins/easy-table/themes/default/style.css?ver=1.5.3' type='text/css' media='all' />
<link rel='stylesheet' id='wp-github-css'  href='http://localhost:4000/wp-content/plugins/wp-github/css/wp-github.css?ver=4.4.2' type='text/css' media='all' />
<link rel='stylesheet' id='kadence_theme-css'  href='http://localhost:4000/wp-content/themes/virtue/assets/css/virtue.css?ver=262' type='text/css' media='all' />
<link rel='stylesheet' id='virtue_skin-css'  href='http://localhost:4000/wp-content/themes/virtue/assets/css/skins/default.css' type='text/css' media='all' />
<link rel='stylesheet' id='redux-google-fonts-virtue-css'  href='http://fonts.googleapis.com/css?family=Lato%3A400&#038;ver=1461468411' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='http://localhost:4000/wp-content/plugins/jetpack/css/jetpack.css?ver=3.8.2' type='text/css' media='all' />
<script type='text/javascript' src='http://localhost:4000/wp-includes/js/jquery/jquery.js?ver=1.11.3'></script>
<script type='text/javascript' src='http://localhost:4000/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/alphanum.js?ver=1.0'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/chosen/chosen.js?ver=1.1.0'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/context/contextmenu.js?ver=3.9.6.1'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/footable.js?ver=2.0.1.2'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/filertify.js?ver=0.3.11'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/soundmanager2.js?ver=2.97a.20130101'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var fileaway_mgmt = {"ajaxurl":"http:\/\/gregorybanderson.elementfx.com\/wp-admin\/admin-ajax.php","nonce":"3ab7f6a9b2","device":"desktop","no_results":"Nothing found.","cancel_link":"Cancel","save_link":"Save","proceed_link":"Proceed","delete_check":"Delete?","ok_label":"OK","confirm_label":"I'm Sure","cancel_label":"Nevermind","file_singular":"file","file_plural":"files","delete_confirm":"You are about to permanently delete numfiles. Are you sure you're OK with that?","tamper1":"Sorry, there was a problem verifying the correct path to the files.","tamper2":"There was an error completing your request. The path to the directory has not been properly defined.","tamper3":"Sorry, but the name you specified cannot be processed.","tamper4":"An error has been triggered.","no_files_selected":"No files have been selected. Click on the table rows of the files you wish to select.","no_files_chosen":"No files have been chosen.","no_action":"No action has been selected.","no_destination":"No destination directory has been selected.","no_subdir_name":"You did not specify a name for your sub-directory.","unreadable_file":"Sorry, a file you have specified could not be read.","build_path":"Please build the path to your destination directory.","no_upload_support":"Your browser does not support the File Upload API. Please update.","exceeds_size":"This file exceeds the prettymax max file size.","type_not_permitted":"This file type is not permitted.","view_all_permitted":"View all permitted file types.","view_all_prohibited":"View all prohibited file types.","double_dots_override":"You may not use double dots or attempt to override the upload directory.","double_dots":"You may not use double dots in the filename.","creation_disabled":"Sub-directory creation is disabled.","no_override":"You may not attempt to override the upload directory.","multi_type":"You may not specify a script filetype prior to a non-script filetype.","upload_failure":"Sorry about that, but filename could not be uploaded.","rename_column":"Rename Column","delete_column":"Delete Column","insert_col_before":"Insert New Column Before","insert_col_after":"Insert New Column After","insert_row":"Insert New Row","delete_row":"Delete Row","save_backup":"Save Backup","new_column_name":"New Column Name","atleast_one_column":"There must be at least one column at all times.","atleast_one_row":"There must be at least one row at all times.","next_label":"Next","create_label":"Create","new_file_name":"New File Name","specify_file_name":"You must specify a file name.","specify_column_name":"You must specify at least one column name.","column_names":"Column Names, Comma-separated"};
/* ]]> */
</script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/management.js?ver=3.9.6.1'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var fileaway_stats = {"ajaxurl":"http:\/\/gregorybanderson.elementfx.com\/wp-admin\/admin-ajax.php","nonce":"dad7ff5350"};
/* ]]> */
</script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/file-away/lib/js/stats.js?ver=3.9.6.1'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/themes/virtue/assets/js/vendor/modernizr.min.js'></script>
<link rel='https://api.w.org/' href='http://localhost:4000/wp-json/' />

 

<link rel='shortlink' href='http://wp.me/P765Dr-l' />


<script> var fileaway_filetype_groups = {'adobe' : ['abf', 'aep', 'afm', 'ai', 'as', 'eps', 'fla', 'flv', 'fm', 'indd', 'pdd', 'pdf', 'pmd', 'ppj', 'prc', 'ps', 'psb', 'psd', 'swf'], 'application' : ['bat', 'dll', 'exe', 'msi'], 'audio' : ['aac', 'aif', 'aifc', 'aiff', 'amr', 'ape', 'au', 'bwf', 'flac', 'iff', 'gsm', 'la', 'm4a', 'm4b', 'm4p', 'mid', 'mp2', 'mp3', 'mpc', 'ogg', 'ots', 'ram', 'raw', 'rex', 'rx2', 'spx', 'swa', 'tta', 'vox', 'wav', 'wma', 'wv'], 'compression' : ['7z', 'a', 'ace', 'afa', 'ar', 'bz2', 'cab', 'cfs', 'cpio', 'cpt', 'dar', 'dd', 'dmg', 'gz', 'lz', 'lzma', 'lzo', 'mar', 'rar', 'rz', 's7z', 'sda', 'sfark', 'shar', 'tar', 'tgz', 'xz', 'z', 'zip', 'zipx', 'zz'], 'css' : ['css', 'less', 'sass', 'scss'], 'image' : ['bmp', 'dds', 'exif', 'gif', 'hdp', 'hdr', 'iff', 'jfif', 'jpeg', 'jpg', 'jxr', 'pam', 'pbm', 'pfm', 'pgm', 'png', 'pnm', 'ppm', 'raw', 'rgbe', 'tga', 'thm', 'tif', 'tiff', 'webp', 'wdp', 'yuv'], 'msdoc' : ['doc', 'docm', 'docx', 'dot', 'dotx'], 'msexcel' : ['xls', 'xlsm', 'xlsb', 'xlsx', 'xlt', 'xltm', 'xltx', 'xlw'], 'openoffice' : ['dbf', 'dbf4', 'odp', 'ods', 'odt', 'stc', 'sti', 'stw', 'sxc', 'sxi', 'sxw'], 'powerpoint' : ['pot', 'potm', 'potx', 'pps', 'ppt', 'pptm', 'pptx', 'pub'], 'script' : ['asp', 'cfm', 'cgi', 'clas', 'class', 'cpp', 'htm', 'html', 'java', 'js', 'php', 'pl', 'py', 'rb', 'shtm', 'shtml', 'xhtm', 'xhtml', 'xml', 'yml'], 'text' : ['123', 'csv', 'log', 'psw', 'rtf', 'sql', 'txt', 'uof', 'uot', 'wk1', 'wks', 'wpd', 'wps'], 'video' : ['avi', 'divx', 'mov', 'm4p', 'm4v', 'mkv', 'mp4', 'mpeg', 'mpg', 'ogv', 'qt', 'rm', 'rmvb', 'vob', 'webm', 'wmv']}; var ssfa_filetype_icons = {'adobe' : '&#x21;', 'application' : '&#x54;', 'audio' : '&#x43;', 'compression' : '&#x27;', 'css' : '&#x28;', 'image' : '&#x31;', 'msdoc' : '&#x23;', 'msexcel' : '&#x24;', 'openoffice' : '&#x22;', 'powerpoint' : '&#x26;', 'script' : '&#x25;', 'text' : '&#x2e;', 'video' : '&#x57;', 'unknown' : '&#x29;'} </script>
<link rel='dns-prefetch' href='//i0.wp.com'>
<link rel='dns-prefetch' href='//i1.wp.com'>
<link rel='dns-prefetch' href='//i2.wp.com'>
<style type='text/css'>img#wpstats{display:none}</style><style type="text/css">#logo {padding-top:0px;}#logo {padding-bottom:0px;}#logo {margin-left:0px;}#logo {margin-right:0px;}#nav-main {margin-top:0px;}#nav-main {margin-bottom:0px;}.headerfont, .tp-caption {font-family:'Palatino Linotype', 'Book Antiqua', Palatino, serif;} 
  .topbarmenu ul li {font-family:Lato;}
  #kadbreadcrumbs {font-family:'MS Serif', 'New York', sans-serif;}input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; } input[type=number] {-moz-appearance: textfield;}.quantity input::-webkit-outer-spin-button,.quantity input::-webkit-inner-spin-button {display: none;}.product_item .product_details h5 {text-transform: none;}.product_item .product_details h5 {min-height:40px;}</style><!--[if lt IE 9]>
<script src="http://localhost:4000/wp-content/themes/virtue/assets/js/vendor/respond.min.js"></script>
<![endif]-->
<style type="text/css" id="syntaxhighlighteranchor"></style>
<link rel="icon" href="http://i0.wp.com/gregorybanderson.elementfx.com/wp-content/uploads/2015/01/cropped-iconga-54b80e4ev1_site_icon.png?fit=32%2C32" sizes="32x32" />
<link rel="icon" href="http://i0.wp.com/gregorybanderson.elementfx.com/wp-content/uploads/2015/01/cropped-iconga-54b80e4ev1_site_icon.png?fit=192%2C192" sizes="192x192" />
<link rel="apple-touch-icon-precomposed" href="http://i0.wp.com/gregorybanderson.elementfx.com/wp-content/uploads/2015/01/cropped-iconga-54b80e4ev1_site_icon.png?fit=180%2C180" />
<meta name="msapplication-TileImage" content="http://i0.wp.com/gregorybanderson.elementfx.com/wp-content/uploads/2015/01/cropped-iconga-54b80e4ev1_site_icon.png?fit=270%2C270" />
<style type="text/css" title="dynamic-css" class="options-output">header #logo a.brand,.logofont{font-family:Lato;line-height:40px;font-weight:400;font-style:normal;font-size:32px;}.kad_tagline{font-family:Lato;line-height:20px;font-weight:400;font-style:normal;color:#444444;font-size:14px;}.product_item .product_details h5{font-family:Lato;line-height:20px;font-weight:normal;font-style:700;font-size:16px;}h1{font-family:'Palatino Linotype', 'Book Antiqua', Palatino, serif;line-height:40px;font-weight:400;font-style:normal;font-size:38px;}h2{font-family:'Bookman Old Style', serif;line-height:40px;font-weight:normal;font-style:normal;font-size:32px;}h3{font-family:'Bookman Old Style', serif;line-height:30px;font-weight:400;font-style:normal;font-size:24px;}h4{font-family:'Bookman Old Style', serif;line-height:25px;font-weight:400;font-style:normal;font-size:20px;}h5{font-family:'Bookman Old Style', serif;line-height:24px;font-weight:700;font-style:normal;font-size:18px;}body{font-family:'MS Serif', 'New York', sans-serif;line-height:20px;font-weight:400;font-style:normal;font-size:14px;}#nav-main ul.sf-menu a{font-family:Lato;line-height:18px;font-weight:400;font-style:normal;font-size:12px;}#nav-second ul.sf-menu a{font-family:Lato;line-height:22px;font-weight:400;font-style:normal;font-size:18px;}.kad-nav-inner .kad-mnav, .kad-mobile-nav .kad-nav-inner li a,.nav-trigger-case{font-family:Lato;line-height:20px;font-weight:400;font-style:normal;font-size:16px;}</style></head>
  <body class="page page-id-21 page-template page-template-page-feature page-template-page-feature-php wide blog-on-quantitative-ecology">
    <div id="wrapper" class="container">
    <div id="kt-skip-link"><a href="#content">Skip to Main Content</a></div><header class="banner headerclass" role="banner">
  <section id="topbar" class="topclass">
    <div class="container">
      <div class="row">
        <div class="col-md-6 col-sm-6 kad-topbar-left">
          <div class="topbarmenu clearfix">
          <ul id="menu-site-links" class="sf-menu"><li  class="menu-home menu-item-297"><a href="http://localhost:4000/">Home</a></li>
<li  class="menu-research menu-item-296"><a href="http://localhost:4000/research/">Research</a></li>
<li  class="menu-eportfolio menu-item-295"><a href="http://localhost:4000/eportfolio/">ePortfolio</a></li>
<li  class="menu-blog-on-quantitative-ecology current-menu-item current_page_item menu-item-323"><a href="http://localhost:4000/blog-on-quantitative-ecology/">Blog on Quantitative Ecology</a></li>
<li  class="menu-curriculum-vitae menu-item-325"><a href="http://localhost:4000/curriculum-vitae/">Curriculum Vitae</a></li>
<li  class="menu-contact menu-item-359"><a href="https://github.com/quanteco">Contact</a></li>
</ul>                                  </div>
        </div><!-- close col-md-6 --> 
        <div class="col-md-6 col-sm-6 kad-topbar-right">
          <div id="topbar-search" class="topbar-widget">
            <form role="search" method="get" id="searchform" class="form-search" action="http://localhost:4000/">
  <label class="hide" for="s">Search for:</label>
  <input type="text" value="" name="s" id="s" class="search-query" placeholder="Search">
  <button type="submit" id="searchsubmit" class="search-icon"><i class="icon-search"></i></button>
</form>        </div>
        </div> <!-- close col-md-6-->
      </div> <!-- Close Row -->
    </div> <!-- Close Container -->
  </section>
  <div class="container">
    <div class="row">
          <div class="col-md-4 clearfix kad-header-left">
            <div id="logo" class="logocase">
              <a class="brand logofont" href="http://localhost:4000/">
                              </a>
                         </div> <!-- Close #logo -->
       </div><!-- close logo span -->
              
    </div> <!-- Close Row -->
     
  </div> <!-- Close Container -->
   
     </header>      <div class="wrap contentclass" role="document">

      	
	<div id="pageheader" class="titleclass">
		<div class="container">
			<div class="page-header">
	<h1 class="entry-title" itemprop="name">
		Developing Distance Based Neighborhood Matrices	</h1>
   	</div>		</div><!--container-->
	</div><!--titleclass-->
	
    <div id="content" class="container">
   		<div class="row">
     		<div class="main col-md-12" role="main">
				<div class="entry-content" itemprop="mainContentOfPage">
<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>
<script type="text/javascript" src="path-to-MathJax/MathJax.js">
</script>

<div class="container">


  <div class="blog-post spacing">
    <p class="summary">R | <span class="date">May 28, 2016</span></p>
    <p><img src="/images/2016-05-16-distance-based-neighborhoods-spantree-plot-1.png" alt="plot of chunk spantree-plot" /></p>

<p>For my first few blog posts, I will be porting over some of my previous blogs from another website, and in doing so, updating some of the code base, infrastructure, and content. I figured that I should first start with my blog posts focusing on dealing with autocorrelation utilizing Moran’s Eigenvector Maps (MEM; Dray et al. 2006, Griffith and Peres-Neto 2006).  The objectives of these posts are to introduce the MEM concepts, develop some R code and functions, and to utilize the functions to analyze some data.
<!--more--></p>

<p>A good place to start is a description of what MEM is and how it is developed.  In short, MEM is multivariate technique that takes a weighted neighborhood matrix and represents it in multivariate space. The advantage of the approach is that it can be incorporated into any linear model based analysis with relative ease. To date, several R packages have been developed recently to perform MEM; however, most lack flexibility and are developed for a certain data type or class. Thus, in these next few posts, I will be developing the functions needed to perform MEM on ordinary matrices and vectors (i.e., data structures that can deal with spatial, temporal, or phylogenetic information).  In addition, I will be developing some methods to select eigenvectors to include in linear models.</p>

<p>This first post will focus on taking a distance matrix and creating a neighborhood matrix from it. This neighborhood matrix can than be used to:</p>

<ol>
  <li>Test for autocorrelation using Moran’s I</li>
  <li>Develop spatial, temporal, spatiotemporal, or phylogenetic eigenvectors that represent autocorrelation patterns.</li>
</ol>

<p>There are a variety of rules that we can use to define these neighborhood matrices, especially if we are dealing with lattice data (i.e., data located in regions). For these cases, we can use rules based on chess piece movements (e.g., rook, queen) to define regions (e.g., counties) that are neighboring. However, often we deal with data within a domain where our data does not explicitly fit into regions, but rather they are points in space, time or even from an evolutionary spectrum. For these cases, we need some way of defining whether a site, time, or species is a neighbor or not with another site, time, or species and a way of expressing the difficultly of exchange between other sites, times, or species. This is where the weighted neighborhood matrix comes in, and this will be the topic of this post.</p>

<p>If we have data that are points in space or time, we can extract a distance matrix from them (this also can be done for phylogenetic distance with the proper genetic information). For example if we have two vectors representing an $X$ and $Y$ coordinate (on a flat plane [if $X$ and $Y$ are latitude and longitude we might need to use a function like geoXY()]), we can calculate a distance matrix in R using the <code class="highlighter-rouge">dist</code> function:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">dist</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">))</span>
</code></pre>
</div>

<p>Here we have combined the two vectors into a matrix using the <code class="highlighter-rouge">cbind</code> function. By default we receive the lower triangle of the distance matrix, but we can see the entire matrix using the command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">dist</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">upper</span><span class="o">=</span><span class="n">T</span><span class="p">,</span><span class="n">diag</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</code></pre>
</div>

<p>or by changing the class of the object created</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">as.matrix</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)))</span>
</code></pre>
</div>

<p>If this distance matrix ($\mathbf{D}$) is stored as an object in <code class="highlighter-rouge">R</code>, we can use a variety of rules to calculate a weighted neighborhood matrix. Below, I focus on four different functions that describe the increase in difficulty of exchange between points or species. These functions are the ones described by Dray et al. (2006) and include: distance-based Moran’s Eigenvector Maps (dbmem), Linear Function, Concave-Down, and Concave-Up.</p>

<p>For all these methods, we need to derive two separate matrices: (1) a connectivity matrix and (2) an edge weight matrix. The connectivity matrix ($\mathbf{B}$) simply contains information on whether points are connected and is binary, with 1s representing connection and 0s representing unconnected sites. The edge weighting matrix ($\mathbf{A}$) is a little more complex and represents the difficulty of exchange between all points in the sample domain.</p>

<p>For the connectivity matrix, all we need is a threshold in which to say sites are no longer connected. Of course we want our function to be flexible, so we should allow this to be a user defined threshold, but there is a standard threshold used for dbmem. This is usually defined as the maximum distance on a minimum span tree. This span tree is simply a tree that connects all sites together with edges, and the minimum span tree is the tree with the lowest cost (i.e., represents the least difficult exchange). Luckily, the <code class="highlighter-rouge">R</code> package <code class="highlighter-rouge">vegan</code> provides an easy way of calculating the minimum span tree, of which we only need to find the maximum.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">vegan</span><span class="p">)</span>
<span class="n">thresh</span><span class="o">=</span><span class="n">max</span><span class="p">(</span><span class="n">spantree</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">$</span><span class="n">dist</span><span class="p">)</span>
</code></pre>
</div>

<p>Once the threshold is defined, we can simply calculate \mathbf{B} using an <code class="highlighter-rouge">apply</code> statement:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">B</span><span class="o">&lt;-</span><span class="n">apply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">ifelse</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">thresh</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
</code></pre>
</div>

<p>Calculating $\mathbf{A}$ can be done similarly, but the weighting depends on which method is used. For dbmem we need to define $\mathbf{A}$ such that:</p>

<script type="math/tex; mode=display">\mathbf{A}=[a_{ij}]=1-\Big (\frac{d_{ij}}{4 \times thresh} \Big )^2,</script>

<p>where $d_{ij}$ indexes the elements of $\mathbf{D}$. The linear function is defined similarly, but no threshold is specified:</p>

<script type="math/tex; mode=display">\mathbf{A}=[a_{ij}]=1-\Big (\frac{d_{ij}}{max(\mathbf{D})} \Big ).</script>

<p>Likewise, the concave-down function is similar to the linear function, with the latter half raised to the power of alpha:</p>

<script type="math/tex; mode=display">\mathbf{A}=[a_{ij}]=1-\Big (\frac{d_{ij}}{max(\mathbf{D})} \Big )^\alpha.</script>

<p>Finally, the concave-up function is defined as:</p>

<script type="math/tex; mode=display">\mathbf{A}=[a_{ij}]=1/d_{ij}^\beta.</script>

<p>The concave-up function represents a similarity that decreases less rapidly for larger values of $\mathbf{D}$. The methods can be easily calculated with an apply function in <code class="highlighter-rouge">R</code> (see code for full function below).</p>

<p>Finally, to compute the weighted neighborhood we just need to take the Hadamard product of $mathbf{B}$ and $\mathbf{A}$. If <code class="highlighter-rouge">R</code> this is simply,</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">W</span><span class="o">&lt;-</span><span class="n">B</span><span class="o">*</span><span class="n">A</span>
</code></pre>
</div>

<p>However, I should note that the diagonal of $\mathbf{W}$ will be ones representing a connection. This is good if we are going to try to derive more complex relationships with other weight matrices (e.g., spatiotemporal designs), but for the most part we would like to have zeros on the diagonal. This can be done simply with the statement:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">diag</span><span class="p">(</span><span class="n">W</span><span class="p">)</span><span class="o">&lt;</span><span class="m">-0</span>
</code></pre>
</div>

<p>Below is a script that is available on github where I have combined all of these weight functions into a general <code class="highlighter-rouge">R</code> function named <code class="highlighter-rouge">weightmatrix</code>. This function requires a distance matrix, the method to be specified, and a few other arguments for flexibility of the function. By default the function performs dbmem weighting and uses a threshold based on a minimum span tree.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">weightmatrix</span><span class="o">&lt;-</span><span class="k">function</span> <span class="p">(</span><span class="n">D</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"dbmem"</span><span class="p">,</span> <span class="s2">"linear"</span><span class="p">,</span> <span class="s2">"concave-up"</span><span class="p">,</span> <span class="s2">"concave-down"</span><span class="p">,</span><span class="s2">"connectivity"</span><span class="p">),</span> <span class="n">thresh</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">beta</span> <span class="o">=</span> <span class="n">NULL</span><span class="p">,</span> <span class="n">diag.mat</span> <span class="o">=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">class</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"dist"</span><span class="p">)</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">as.matrix</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
  <span class="n">require</span><span class="p">(</span><span class="n">vegan</span><span class="p">)</span>
  <span class="n">n</span> <span class="o">&lt;-</span> <span class="n">dim</span><span class="p">(</span><span class="n">D</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">is.null</span><span class="p">(</span><span class="n">thresh</span><span class="p">))</span>
    <span class="n">thresh</span> <span class="o">=</span> <span class="n">max</span><span class="p">(</span><span class="n">spantree</span><span class="p">(</span><span class="n">D</span><span class="p">)</span><span class="o">$</span><span class="n">dist</span><span class="p">)</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span> <span class="o">&lt;-</span> <span class="n">array</span><span class="p">(</span><span class="n">dim</span> <span class="o">=</span> <span class="n">dim</span><span class="p">(</span><span class="n">D</span><span class="p">)))</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">length</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="o">&gt;</span> <span class="m">1</span><span class="p">)</span>
    <span class="n">method</span> <span class="o">=</span> <span class="s2">"dbmem"</span>
  <span class="n">B</span><span class="o">&lt;-</span><span class="n">apply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">ifelse</span><span class="p">(</span><span class="n">x</span><span class="o">&gt;</span><span class="n">thresh</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
  <span class="k">if</span><span class="p">(</span><span class="n">method</span><span class="o">==</span><span class="s2">"dbmem"</span><span class="p">)</span> <span class="n">A</span><span class="o">&lt;-</span><span class="n">apply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="m">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">x</span><span class="o">/</span><span class="p">(</span><span class="m">4</span> <span class="o">*</span> <span class="n">thresh</span><span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">))</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">method</span><span class="o">==</span><span class="s2">"linear"</span><span class="p">)</span><span class="n">A</span><span class="o">&lt;-</span><span class="n">apply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="m">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">max</span><span class="p">(</span><span class="n">D</span><span class="p">)))</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"concave-down"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is.null</span><span class="p">(</span><span class="n">alpha</span><span class="p">))</span> <span class="n">stop</span><span class="p">(</span><span class="s2">"alpha must be specified for the method 'concave-down'"</span><span class="p">)</span>
    <span class="n">A</span><span class="o">&lt;-</span><span class="n">apply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="m">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">max</span><span class="p">(</span><span class="n">D</span><span class="p">))</span><span class="o">^</span><span class="n">alpha</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"concave-up"</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">is.null</span><span class="p">(</span><span class="n">beta</span><span class="p">))</span> <span class="n">stop</span><span class="p">(</span><span class="s2">"beta must be specified for the method 'concave-up"</span><span class="p">)</span>
    <span class="n">A</span><span class="o">&lt;-</span><span class="n">apply</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="m">2</span><span class="p">,</span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="m">1</span><span class="o">/</span><span class="n">x</span><span class="o">^</span><span class="n">beta</span><span class="p">)</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"connectivity"</span><span class="p">)</span><span class="n">A</span><span class="o">&lt;-</span><span class="n">B</span>
  <span class="k">else</span> <span class="n">stop</span><span class="p">(</span><span class="s2">"method must be 'dbmem', 'linear', 'concave-up', 'concave-down', or 'connectivity'"</span><span class="p">)</span>
  <span class="n">out</span> <span class="o">&lt;-</span> <span class="n">A</span> <span class="o">*</span> <span class="n">B</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">diag.mat</span> <span class="o">==</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">diag</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="m">0</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>Now, let’s try the function. We need to simulate some data and run the function. For sake of simplicity, we will perform the <code class="highlighter-rouge">dbmem</code> weighting.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">D</span><span class="o">&lt;-</span><span class="n">as.matrix</span><span class="p">(</span><span class="n">dist</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">),</span><span class="n">runif</span><span class="p">(</span><span class="m">100</span><span class="p">,</span><span class="m">0</span><span class="p">,</span><span class="m">100</span><span class="p">))))</span>
<span class="n">W</span><span class="o">&lt;-</span><span class="n">weightmatrix</span><span class="p">(</span><span class="n">D</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s2">"dbmem"</span><span class="p">)</span>
<span class="n">W</span>
</code></pre>
</div>

<p>Everything seems to work!</p>

<p>As with most of the functions created on this blog, the weightmatrix function is available in my github repository and can be installed (along with other functions from my blog) using the following <code class="highlighter-rouge">R</code> commands:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span>
<span class="n">install_github</span><span class="p">(</span><span class="s2">"quanteco/quanteco"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">quanteco</span><span class="p">)</span>
</code></pre>
</div>

<p>The benefit of installing the package, instead of coping the code, is that you will also get the associated help files and examples.</p>

<h1 id="references">References</h1>

<p>Dray, S., P. Legendre, and P. R. Peres-Neto. 2006. Spatial modeling: a comprehensive framework for principal coordinate analysis of neighborhood matrices (PCNM). Ecological Modeling 196:483-493.</p>

<p>Griffith, D. A., and P. R. Peres-Neto. 2006. Spatial modeling in ecology: the flexibility of eigenfunction spatial analyses. Ecology 87:2603–2613.</p>

  </div>
</div>  				</div>
							</div><!-- /.main -->            
                    </div><!-- /.row-->
        </div><!-- /.content -->
      </div><!-- /.wrap -->
      <footer id="containerfooter" class="footerclass" role="contentinfo">
  <div class="container">
  	<div class="row">
  								        			        </div>
        <div class="footercredits clearfix">
    		
    		        	<p>&copy; 2016 Gregory B. Anderson. All Rights Reserved.</p>
    	</div>

  </div>

</footer>

	<div style="display:none">
	</div>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/resume-builder/js/jquery.raty.js?ver=1.0'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/resume-builder/js/functions.js?ver=1.0'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/jetpack/modules/photon/photon.js?ver=20130122'></script>
<script type='text/javascript' src='http://s0.wp.com/wp-content/js/devicepx-jetpack.js?ver=201617'></script>
<script type='text/javascript' src='http://s.gravatar.com/js/gprofiles.js?ver=2016Mayaa'></script>
<script type='text/javascript'>
/* <![CDATA[ */
var WPGroHo = {"my_hash":""};
/* ]]> */
</script>
<script type='text/javascript' src='http://localhost:4000/wp-content/plugins/jetpack/modules/wpgroho.js?ver=4.4.2'></script>
<script type='text/javascript' src='http://localhost:4000/wp-includes/js/masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/themes/virtue/assets/js/min/plugins-min.js?ver=262'></script>
<script type='text/javascript' src='http://localhost:4000/wp-content/themes/virtue/assets/js/main.js?ver=262'></script>
<script type='text/javascript' src='http://localhost:4000/wp-includes/js/wp-embed.min.js?ver=4.4.2'></script>
<script type='text/javascript' src='http://stats.wp.com/e-201617.js' async defer></script>
<script type='text/javascript'>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:3.8.2',blog:'104885985',post:'21',tz:'0',srv:'gregorybanderson.elementfx.com'} ]);
	_stq.push([ 'clickTrackerInit', '104885985', '21' ]);
</script>
    </div><!--Wrapper-->
  </body>
</html>
